<!doctype html><html lang=ja><head><meta charset=utf-8><title>アプリのアップデート時にAlarmManagerがキャンセルされなくなっていた</title>
<meta name=description content="Android 2.2以降はアプリのアップデート時にAlarmManagerがキャンセルされなくなっている"><script async src="https://www.googletagmanager.com/gtag/js?id=G-RTC3ZY943S"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-RTC3ZY943S")</script><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.keiji.dev/index.xml title=めがねをかけるんだ><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.keiji.dev/images/logo.png"><meta name=twitter:title content="アプリのアップデート時にAlarmManagerがキャンセルされなくなっていた"><meta name=twitter:description content="Android 2.2以降はアプリのアップデート時にAlarmManagerがキャンセルされなくなっている"><link rel=stylesheet href=https://blog.keiji.dev/fontawesome/css/all.min.css><link crossorigin=anonymous href=https://blog.keiji.dev/css/styles.min.css integrity rel="preload stylesheet" as=style><link rel=stylesheet href=https://blog.keiji.dev/css/default.css><link id=dark-mode-theme crossorigin=anonymous href=https://blog.keiji.dev/css/dark.min.css integrity rel="preload stylesheet" as=style><script>var darkTheme=document.getElementById("dark-mode-theme"),storedTheme=localStorage.getItem("dark-mode-storage");storedTheme==="dark"?darkTheme.disabled=!1:storedTheme==="light"&&(darkTheme.disabled=!0)</script><script defer crossorigin=anonymous src=https://blog.keiji.dev/js/theme.js integrity></script><script defer crossorigin=anonymous src=https://blog.keiji.dev/js/instantpage.min.js integrity></script><meta name=generator content="Hugo 0.133.0"></head><body><header><nav class=navbar><div class=nav><a href=https://blog.keiji.dev/ class=nav-logo><img src=https://blog.keiji.dev/images/logo.png width height alt=Logo></a><ul class=nav-links><li><a href=https://blog.keiji.dev/profile/ id=Profile><em class="fas fa-user fa-lg"></em></a></li><li><a href=https://blog.keiji.dev/licenses/ id=Licenses><em class="fab fa-osi fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>アプリのアップデート時にAlarmManagerがキャンセルされなくなっていた</h1><span class=meta-post><em class="fa fa-calendar-alt"></em>&nbsp;2021-03-20
&nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
<a href=https://blog.keiji.dev/categories/%E9%9B%91%E8%A8%98/>雑記</a>&nbsp;
<a href=https://blog.keiji.dev/categories/cocoa/>COCOA</a>&nbsp;
<a href=https://blog.keiji.dev/categories/android/>Android</a>&nbsp;</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>　16日からCOCOAのコラボレーターになってIssueやPRの対応をしています。</p><p>　<a href=https://blog.keiji.dev/2021/03/cocoa.html>先日の記事</a>について、たくさんの方から激励の言葉をいただきました。ありがとうございます。
厚生労働省技術参与の着任から10日、コラボレーターになってから5日が経ちました。Twitterで普段しないエゴサをしたりしますと、やはりぼくの至らぬ点についてお叱りを受けていることも目に入ったりして反省しきりの日々です。</p><p>　今後も鋭意改善に努めて参りますので、何卒よろしくお願いいたします。</p><p>さて、今日はCOCOAに投稿されたIssueの中でぼくが特に勉強になったものを紹介します（すべてのIssueが勉強になっていますよ念のため）。</p><ul><li>Android 版でアプリアップデート後にログのローテートが正しく行われるか検証が必要<ul><li><a href=https://github.com/cocoa-mhlw/cocoa/issues/62>https://github.com/cocoa-mhlw/cocoa/issues/62</a></li></ul></li></ul><p>　ログのローテーションをAlarmManagerで実行しているのですが、AlarmManagerはいくつかのタイミングでキャンセルされるはず。再起動時は<code>BOOT_COMPLETED</code>で処置しているけど、アプリのアップデート時は大丈夫？　と言う内容になります。投稿者は<a href=https://twitter.com/zipperpull>@zipperpull</a>さんです。いつもありがとうございます。</p><p>　検証とか必要なことは全部<a href=https://github.com/cocoa-mhlw/cocoa/issues/62#issuecomment-803267473>Issueのコメント</a>に書いたので、詳しくはそっちを見てください。</p><p>　大事なのは、ぼく自身「AlarmManagerに設定したジョブはアプリのアップデートでキャンセルされる」と覚えていたことです。</p><p>　実際、この課題を検索すると「キャンセルされる」ことを裏付ける情報が見つかり、いくつかの対応策が提案されています。</p><p>　しかし、実際にコードで検証してみるとキャンセルされず、さらに調べてようやくAndroid 2.2以降では挙動が変わっているという情報を探し当てました。</p><p>　Android 2.2といえばリリースは2010年です。普段「ぼくはAndroidなら輝けるんだ」とかいっておきながら、この件に関してぼくの知識は10年以上も知識が更新されていなかったことになります。</p><p>　反省すると同時に、意外なところで知識を新しくできた喜びを感じています。</p><p>追伸：「いや、キャンセルされるぞ」って情報があったら教えてください。よろしくお願いいたします。</p></article></div><footer><div class=social-icons></div><div class=container><p class="credits copyright"><a href=https://blog.keiji.dev/about></a>&nbsp;&copy;
2025
&nbsp;/&nbsp;
<a href=https://blog.keiji.dev/>めがねをかけるんだ</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>