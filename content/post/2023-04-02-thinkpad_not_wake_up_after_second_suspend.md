---
title: ThinkPadのスリープが2度目から失敗するようになった
author: Keiji Ariyama
type: post
date: 2023-04-02T16:00:00+09:00
url: /2023/04/heading.html
categories:
  - 雑記
---

2023年3月31日付けで、厚生労働省の技術参与を辞任しました。

COCOAも正式に終了して、これ以上することもありません（GitHubへの書き込みだけであれば参与じゃなくてもできます）。
また、辞任と言うのは、参与でなくなる方法が、ぼくの方から辞任する以外にないっぽいので、べつに喧嘩して辞めたとかそういうことではないのでご安心ください。

COCOAを通じてお話しする機会をいただいた皆さん。本当にありがとうございました。
今後ともよろしくお願い致します。

----

### 忙しい人向けのまとめ

ThinkPadのスリープが2度目から失敗する現象に遭遇しました。
原因はセキュリティアップデートに含まれる`linux-headers-generic-hwe`パッケージでした。

原因のパッケージ`linux-headers-generic-hwe`をダウングレードして、念のためカーネルのバージョンも前のバージョン（`5.19.0.21.21`）に戻すことで、ひとまず現象は解消しました。

```
$ sudo apt install linux-headers-generic-hwe-22.04=5.19.0.21.21
```

----

さて、期首の休日と言うこともあり、仕事で使っているPGPの公開鍵を作り直したり（期限の延長ではなく、新しいものを作る）、以前使っていたものを失効させたりしながら過ごしています。

以前ブログにも書いた「ThinkPad X13 Gen3」は、あれからUbuntuをインストールしました。
しばらくは仲良くしていたのですが、いつの頃からか、蓋を閉じたときにスリープせずに、そのままフリーズしているのに気がつきました。

時間があったのでUbuntuを`22.04.2 LTS`から`22.10`にアップグレードしてみたけど状況は変わらず。
ならばとクリーンインストールをしてみても、フリーズは解消されませんでした。

あれこれ試していると、期待通りスリープ・レジュームができていることもありました。
どうやら一度目は正常で、二度目のスリープに失敗している様子です。

調べてみると、そのものずばりのIssueを発見しました。

Ubuntu 22.04 not waking up after second suspend
https://bugs.launchpad.net/ubuntu/+source/linux-signed-hwe-5.19/+bug/2008774

Ryzen CPUのマシンにインストールしたときに発生する不具合のようです。

直接の原因のパッケージ（`linux-headers-generic-hwe`）は、セキュリティアップデートに含まれます。
ぼくはセキュリティアップデートは自動適用にしていました。また、Ubuntuをインストールするときに、インターネットからアップデートを取得して適応するというオプションを有効にしていたため、クリーンインストールでも発生しました。

原因のパッケージ `linux-headers-generic-hwe` をダウングレードして、念のためカーネルのバージョンを前のバージョン（`5.19.0.21.21`）に戻したら解決しました。

```
$ sudo apt install linux-headers-generic-hwe-22.04=5.19.0.21.21
```

今回は緊急的にダウングレードしましたが、パッケージのバージョンは上げていきたいので、今後の対応状況に応じて再度アップグレードを試みるつもりです。
